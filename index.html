<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misi√≥n: Reina Sof√≠a | El Relato de la Vanguardia</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;700;900&display=swap');
        
        :root {
            --museum-bg: #f5f5f4;
            --museum-accent: #b91c1c;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--museum-bg);
            color: #1c1917;
            scroll-behavior: smooth;
        }

        h2 { font-size: 1.875rem; line-height: 2.25rem; } /* text-3xl en m√≥vil */

        .serif-text {
            font-family: 'Crimson Pro', serif;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            height: 300px;
            max-height: 40vh;
        }

        .mission-card {
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent; /* Evita el recuadro azul al tocar en m√≥vil */
        }

        .mission-card.locked {
            opacity: 0.4;
            filter: grayscale(1);
            pointer-events: none;
        }

        .mission-card.completed {
            border-left: 6px solid #16a34a;
            background-color: white;
        }

        .mission-card.active {
            border-left: 0;
            border-top: 6px solid var(--museum-accent);
            background-color: #ffffff;
            transform: scale(1.02);
        }

        .check-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            cursor: pointer;
        }

        .timeline-slot {
            min-width: 140px;
            height: 100px;
            border: 2px dashed #d6d3d1;
            border-radius: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .timeline-slot.correct {
            border: 2px solid #16a34a;
            background-color: #f0fdf4;
        }
        .timeline-slot.hint {
            border-color: var(--museum-accent);
            background-color: #fef2f2;
        }

        .timeline-slot:hover {
            border-color: var(--museum-accent);
            background-color: #fff1f2;
        }

        .timeline-slot.locked {
            opacity: 0.4;
            background-color: #e7e5e4;
            cursor: not-allowed;
            border-style: solid;
        }

        .slot-year {
            font-size: 1.25rem;
            font-weight: 900;
            color: #a8a29e;
        }

        .timeline-item::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 100%;
            width: 2px;
            height: 2rem;
            background: #d6d3d1;
        }

        .timeline-item:last-child::after {
            display: none;
        }

        .input-code {
            border: 2px solid #d6d3d1;
            padding: 8px 12px;
            border-radius: 8px;
            width: 100%;
            font-weight: bold;
            text-transform: uppercase;
        }

        .input-code:focus {
            border-color: var(--museum-accent);
            outline: none;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .error-shake { animation: shake 0.2s ease-in-out 0s 2; }
    </style>
</head>
<body class="antialiased">

    <!-- Nav -->
    <nav class="sticky top-0 z-50 bg-white/95 backdrop-blur-md border-b border-stone-200 py-3 shadow-sm">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <span class="bg-stone-900 text-white font-black px-2 py-1 text-xl">RS</span>
                <h1 class="text-[10px] font-bold uppercase tracking-tighter text-stone-600 leading-tight w-24 md:w-auto">180 Min. Vanguardia</h1>
            </div>
            <div class="flex items-center space-x-3">
                <div class="text-right">
                    <p id="counter-display" class="text-lg font-black text-red-700">0 / 15</p>
                </div>
                <div class="w-16 h-1.5 bg-stone-200 rounded-full mt-1 overflow-hidden">
                    <div id="progress-bar" class="h-full bg-red-700 transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-6 py-10 max-w-6xl">
        
        <!-- Dashboard Superior -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-10">
            <div class="lg:col-span-2 space-y-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-100">
                    <h2 class="text-3xl font-black text-stone-900 mb-4 leading-none">Tu Investigaci√≥n de Campo</h2>
                    <p class="text-stone-600 text-base leading-relaxed serif-text italic mb-4">
                        "El arte no es un espejo para reflejar la realidad, sino un martillo para darle forma". 
                    </p>
                    <p class="text-stone-600 mt-4 leading-relaxed">
                        Bienvenido a la misi√≥n expandida. Tienes ante ti 15 hitos que narran el convulso siglo XX espa√±ol. 
                        Este itinerario ha sido dise√±ado para completarse en <b>3 horas exactas</b>.
                    </p>
                    <div class="mt-8 flex flex-wrap gap-4">
                        <a href="#mission-start" class="bg-red-700 hover:bg-red-800 text-white px-8 py-3 rounded-full font-bold transition shadow-lg shadow-red-100">Iniciar Operaci√≥n</a>
                        <a href="https://recursos.museoreinasofia.es/accesibilidad_planos_servicios.pdf" target="_blank" class="bg-red-700 hover:bg-red-800 text-white px-8 py-3 rounded-full font-bold transition shadow-lg flex items-center gap-2">
                            <span>Ver Planos del Museo</span>
                        </a>
                        <div class="hidden sm:flex items-center space-x-2 text-stone-400 text-sm">
                            <span>üìç Planta 2, Edificio Sabatini</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Gymkana Engine -->
        <section id="mission-start" class="space-y-8 mb-24">
            <div class="flex items-center space-x-4 mb-8">
                <div class="h-px bg-stone-300 flex-grow"></div>
                <h2 class="text-2xl font-black text-stone-800 uppercase tracking-tighter">Itinerario de Misiones</h2>
                <div class="h-px bg-stone-300 flex-grow"></div>
            </div>

            <div id="mission-container" class="grid grid-cols-1 gap-6">
                <!-- Se poblar√° v√≠a JavaScript -->
            </div>
        </section>

        <!-- Nueva Secci√≥n: L√≠nea Temporal -->
        <section class="mt-24 mb-24">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-black text-stone-900 uppercase tracking-tighter italic">L√≠nea del Tiempo Art√≠stica</h2>
                <p class="text-stone-500 text-sm mt-2">Ubica las obras encontradas en su lugar correcto de la historia</p>
            </div>

            <div id="pending-tray" class="flex flex-wrap justify-center gap-4 mb-12 min-h-[100px] p-4 bg-white rounded-xl shadow-inner border-2 border-dashed border-stone-200">
                <p class="text-stone-400 text-sm self-center">Encuentra obras en la gymkana para activarlas aqu√≠...</p>
            </div>
            
            <div class="relative overflow-x-auto pb-8">
                <div class="flex min-w-max gap-8 px-4" id="timeline-container">
                    <!-- Se poblar√° v√≠a JavaScript -->
                </div>
            </div>
        </section>

        <!-- An√°lisis Global -->
        <section class="mt-24 border-t border-stone-200 pt-16">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-16 items-center">
                <div>
                    <h3 class="text-3xl font-black text-stone-900 mb-6">El ADN de la Vanguardia</h3>
                    <p class="text-stone-600 leading-relaxed mb-6">
                        A trav√©s de estas 15 obras, habr√°s recorrido el Cubismo anal√≠tico, el Surrealismo psicol√≥gico, el trauma de la Guerra Civil y la posterior introspecci√≥n informalista. El museo no es solo una colecci√≥n de cuadros, sino un archivo vivo de la identidad espa√±ola.
                    </p>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="p-4 bg-white border border-stone-100 rounded-xl shadow-sm">
                            <p class="text-2xl font-black text-red-700">1937</p>
                            <p class="text-[10px] text-stone-400 uppercase font-bold">A√±o Clave</p>
                        </div>
                        <div class="p-4 bg-white border border-stone-100 rounded-xl shadow-sm">
                            <p class="text-2xl font-black text-red-700">65%</p>
                            <p class="text-[10px] text-stone-400 uppercase font-bold">Obras en P2</p>
                        </div>
                    </div>
                </div>
                <div class="chart-container" style="height: 300px;">
                    <canvas id="movementChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Nueva Secci√≥n: Distribuci√≥n por Pintor -->
        <section class="mt-24 border-t border-stone-200 pt-16 mb-20">
            <!-- KPI Cards -->
            <section class="grid grid-cols-2 gap-3 md:gap-16">
                <div class="bg-white overflow-hidden shadow rounded-lg border-t-4 border-red-500 p-3 md:p-5 text-center transform transition duration-300">
                    <dt class="text-[10px] md:text-sm font-medium text-gray-500 uppercase tracking-widest leading-tight">Total de Obras</dt>
                    <dd class="mt-1 text-2xl md:text-5xl font-extrabold text-gray-800" id="total-works-display">Loading...</dd>
                    <p class="mt-1 text-[10px] md:text-xs text-gray-400 xs:block">Incluye pintura, escultura, grabado y dibujo.</p>
                </div>
                <div class="bg-white overflow-hidden shadow rounded-lg border-t-4 border-gray-700 p-3 md:p-5 text-center transform transition duration-300">
                    <dt class="text-[10px] md:text-sm font-medium text-gray-500 uppercase tracking-widest leading-tight">Total Artistas</dt>
                    <dd class="mt-1 text-2xl md:text-5xl font-extrabold text-gray-800" id="total-artists-display">Loading...</dd>
                    <p class="mt-1 text-[10px] md:text-xs text-gray-400 xs:block">Desde finales del s.XIX hasta la actualidad.</p>
                </div>
            </section>

            <!-- Main Dashboard: Top 10 Artists -->
            <section id="dashboard" class="bg-white shadow-lg rounded-xl overflow-hidden gap-16">
                <div class="p-6 border-b border-gray-100 bg-gray-50">
                    <h2 class="text-2xl font-bold text-gray-900">Los 10 Artistas M√°s Representados</h2>
                    <p class="text-sm text-gray-500 mt-1">
                        Selecciona un artista de la lista para ver su impacto porcentual en la colecci√≥n total.
                    </p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3">
                    <!-- Left: List of Artists -->
                    <div class="col-span-1 border-b lg:border-b-0 lg:border-r border-gray-100 max-h-64 lg:max-h-none overflow-y-auto" id="artist-list-container">
                        <!-- JS will populate this list -->
                    </div>

                    <!-- Middle/Right: Chart & Detail View -->
                    <div class="col-span-1 lg:col-span-2 p-4 flex flex-col items-center justify-center relative">
                        
                        <!-- Detail Card Overlay (Dynamic) -->
                        <div id="artist-detail-card" class="mb-4 w-full bg-red-50 border border-red-100 rounded-lg p-4 hidden">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="text-xl font-bold text-red-800" id="detail-name">Nombre Artista</h3>
                                    <p class="text-sm text-red-600 mt-1">Obras en cat√°logo: <span class="font-bold text-lg" id="detail-count">0</span></p>
                                </div>
                                <div class="text-right">
                                    <span class="block text-xs text-red-500 uppercase font-bold">Cuota de Colecci√≥n</span>
                                    <span class="text-3xl font-bold text-gray-900" id="detail-percentage">0%</span>
                                </div>
                            </div>
                            <p class="mt-3 text-sm text-gray-700 italic" id="detail-desc">Descripci√≥n...</p>
                        </div>

                        <!-- Chart Container -->
                        <div class="chart-container">
                            <canvas id="topArtistsChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>
        </section>

        <section id="final-screen" class="hidden mt-20 p-10 bg-stone-900 text-white rounded-3xl text-center">
            <h2 class="text-5xl font-black mb-6">¬°MISI√ìN CUMPLIDA!</h2>
            <p class="text-xl mb-8">Has descifrado los 15 c√≥digos del Reina Sof√≠a. Las puertas de la ampliaci√≥n de Nouvel est√°n abiertas.</p>
            <button onclick="location.reload()" class="bg-red-600 px-8 py-4 rounded-full font-bold hover:bg-red-700 transition">Reiniciar Experiencia</button>
        </section>

    </main>

    <footer class="bg-stone-100 py-20 mt-20 border-t border-stone-200">
        <div class="container mx-auto px-6 text-center">
            <p class="text-stone-500 font-bold mb-2">Misi√≥n Cultural: Reina Sof√≠a</p>
            <p class="text-stone-400 text-xs serif-text italic max-w-md mx-auto">
                "Todo acto de creaci√≥n es, sobre todo, un acto de destrucci√≥n". ‚Äî Picasso.
            </p>
        </div>
    </footer>

    <script>
        const museumData = {
            totalWorks: 24000,
            totalArtists: 5800,
            topArtists: [
                { name: "Joan Mir√≥", count: 580, desc: "Pintor, escultor y ceramista surrealista. Su gran volumen se debe a importantes donaciones de obra gr√°fica." },
                { name: "Pablo Picasso", count: 410, desc: "La figura central del museo. Alberga el Guernica y una vasta colecci√≥n de dibujos preparatorios." },
                { name: "Julio Gonz√°lez", count: 390, desc: "Pionero de la escultura en hierro. Gran parte de su legado reside aqu√≠ gracias a donaciones familiares." },
                { name: "Salvador Dal√≠", count: 350, desc: "Icono del surrealismo. El museo posee obras maestras como 'El Gran Masturbador'." },
                { name: "Antoni T√†pies", count: 240, desc: "Maestro del informalismo y la pintura mat√©rica. Fundamental en la colecci√≥n de posguerra." },
                { name: "Eduardo Chillida", count: 160, desc: "Escultor vasco conocido por sus obras monumentales en acero y hormig√≥n." },
                { name: "Antonio Saura", count: 125, desc: "Fundador del grupo El Paso. Conocido por sus series expresionistas y gestuales." },
                { name: "Juan Gris", count: 85, desc: "El gran maestro del cubismo sint√©tico. Una colecci√≥n peque√±a pero de alt√≠sima calidad." },
                { name: "Francis Picabia", count: 65, desc: "Figura clave del dada√≠smo y el surrealismo, con una obra ecl√©ctica y cambiante." },
                { name: "Luis Gordillo", count: 60, desc: "P referente de la nueva figuraci√≥n madrile√±a y el arte pop en Espa√±a." }
            ]
        };

        let selectedArtistIndex = -1; // No selection initially
        let mainChartInstance = null;
        let comparisonChartInstance = null;

        let placedMissions = []; 
        let selectedFromTray = null;

        const missions = [
            { id: 1, year: 1920, artist: "Jos√© Guti√©rrez Solana", title: "La Tertulia de Pombo", 
            loc: "Sabatini, P2, Sala 201", 
            clue: "Hombres trajeados reunidos en una mesa.",
            answer: "Jos√© Guti√©rrez Solana, La Tertulia del Caf√© de Pombo.", 
            challenge: "¬øCu√°ntos personajes en la mesa miran directamente al espectador?", 
                requiredValue: "4", 
                hint: "Cuenta a los que rompen la 'cuarta pared' con su mirada.",
                context: "La luz de gas y los tonos oscuros reflejan la visi√≥n amarga de la Espa√±a de 1920. Durante el siglo XIX y hasta la Guerra Civil, los caf√©s se consolidaron como instituciones fundamentales en la vida cultural de Madrid por las tertulias que en ellos se realizaban. El m√°s importante fue el Caf√© de Pombo, un antiguo establecimiento de la calle Carretas frecuentado por la vanguardia espa√±ola a partir de 1915. En la obra aparece Ram√≥n G√≥mez de la Serna de pie, rodeado de figuras como Manuel Abril, Jos√© Bergam√≠n y el propio pintor Solana. La luz de gas y los tonos oscuros acent√∫an una atm√≥sfera casi f√∫nebre, reflejando la visi√≥n amarga y profunda de la Espa√±a de la √©poca. Esta pintura act√∫a como acta fundacional del Madrid intelectual previo al trauma de la contienda civil.", 
            zone: "Generaci√≥n de plata" },

            { id: 2, year: 1901, artist: "Pablo Picasso", title: "Mujer en Azul", 
            loc: "Sabatini, P2, Sala 201", 
            clue: "Una mujer imponente, vestida con un azul vibrante.", 
            answer: "Pablo Picasso, 'Mujer en azul'", 
            challenge: "¬øCu√°ntos botones dorados/visibles tiene el traje de la mujer?", 
                requiredValue: "3", 
                hint: "Mira con atenci√≥n la parte central del corpi√±o.",
            context: "Pintada durante la breve estancia de Picasso en Madrid en 1901, esta obra es un puente entre su aprendizaje juvenil y su inminente √âpoca Azul. La figura evoca la estructura de las damas de Vel√°zquez, pero con una ejecuci√≥n t√©cnica que recuerda a la obra de Toulouse-Lautrec en Par√≠s. El rostro de la mujer, con un maquillaje excesivo y una expresi√≥n de melancol√≠a, sugiere la vida nocturna y la decadencia de la 'Belle √âpoque'. Fue presentada en la Exposici√≥n Nacional de Bellas Artes, recibiendo solo una menci√≥n honor√≠fica que frustr√≥ profundamente al joven artista. Hoy se entiende como una declaraci√≥n de intenciones: Picasso ya era capaz de dialogar con la tradici√≥n espa√±ola mientras la subvert√≠a con modernidad.",
                zone: "Protovanguardia"},

            { id: 3, year: 1927, artist: "Maruja Mallo", title: "La Verbena de la Libertad", 
            loc: "Sabatini, P2, Sala 203", 
            clue: "Figuras populares y gigantes en una fiesta ca√≥tica.", 
            answer: "Maruja Mallo, 'La verbena'",
            challenge: "¬øQu√© animal aparece repetido tres veces en la noria? (Escribe la palabra)", 
                requiredValue: "GATO", 
                hint: "Es un animal dom√©stico peque√±o.", 
            context: "Maruja Mallo fue una de las figuras m√°s transgresoras de la Generaci√≥n del 27 y form√≥ parte de las 'Sinsombrero'. En su serie 'La verbena', la artista expon√≠a en la muestra individual que le hab√≠a organizado Ortega y Gasset en las salas de la Revista de Occidente los 4 √≥leos dedicados a las fiestas madrile√±as. Inventa escenas plenas de barroquismo y carentes de l√≥gica. Se muestran los elementos t√≠picos de las fiestas populares madrile√±as (barracha del pim-pam-pum, artefacto para medir la fuerza, gigant√≥n de un solo ojo, freaile en atracciones o pies deformes que piden limosna con la guitarra a la espalda).",
                zone: "Vanguardia Espa√±ola" },

            { id: 4, year: 1914, artist: "Juan Gris", title: "La Botella de An√≠s", 
            loc: "Sabatini, P2, Sala 204", 
            clue: "Busca un fragmento de una etiqueta real de 'An√≠s del Mono'.", 
            answer: "Juan Gris, 'La botella de an√≠s'", 
            challenge: "En la etiqueta del mono, ¬øqu√© nombre de ciudad espa√±ola aparece junto a Par√≠s y Madrid?", 
                requiredValue: "BADALONA", 
                hint: "Est√° en la costa catalana.",
            context: "Juan Gris es considerado el gran maestro del cubismo sint√©tico y esta obra es un ejemplo supremo de su rigor matem√°tico. En ella, Gris rinde homenaje a los l√≠deres del movimiento mencionando ciudades clave como Badalona, Madrid y Par√≠s. A diferencia de Picasso, Gris utiliza una estructura arquitect√≥nica muy definida donde los objetos no solo se fragmentan, sino que se reconstruyen mediante rimas visuales. La etiqueta del licor espa√±ol 'An√≠s del Mono' sirve como ancla de realidad en una composici√≥n de gran complejidad geom√©trica. Es una pieza que demuestra c√≥mo el cubismo pod√≠a ser simult√°neamente intelectual, preciso y profundamente decorativo.",
                zone: "Cubismo" },

            { id: 5, year: 1925, artist: "Salvador Dal√≠", title: "Mirando al Mar de Cadaqu√©s", 
            loc: "Sabatini, P2, Sala 205", clue: "Una joven de espaldas, asomada a una ventana.", 
            answer: "Salvador Dal√≠, 'Muchacha en la ventana'", 
            challenge: "¬øCu√°ntas hojas de la ventana est√°n abiertas?", 
                requiredValue: "1", 
                hint: "Solo una permite ver el mar de Cadaqu√©s.",
            context: "Antes de sumergirse en la locura surrealista, Dal√≠ pas√≥ por una etapa de realismo meticuloso y ordenado influenciado por el movimiento italiano 'Valori Plastici'. La modelo es su hermana Ana Mar√≠a, quien fue su musa principal antes de la llegada de Gala a su vida. La composici√≥n utiliza la ventana como un marco dentro del cuadro, creando un juego de perspectivas que invita a la contemplaci√≥n serena. Los tonos azules y la luz mediterr√°nea capturan la esencia del paisaje de Cadaqu√©s, un lugar sagrado para el artista. Esta obra demuestra la asombrosa capacidad t√©cnica de Dal√≠ para captar la realidad f√≠sica antes de dedicarse a pintar 'fotograf√≠as del subconsciente'.",
                zone: "Realismo" },

            { id: 6, year: 1929, artist: "√Ångeles Santos", title: "El Sue√±o de √Ångeles Santos", 
            loc: "Sabatini, P2, Sala 205", 
            clue: "Un cuadro cuadrado inmenso que muestra un planeta habitado por mujeres.", 
            answer: "√Ångeles Santos, 'Un mundo'", 
            challenge: "¬øQu√© forma geom√©trica tiene el planeta central del cuadro?", 
                requiredValue: "CUBO", 
                hint: "No es como la Tierra real.",
            context: "√Ångeles Santos pint√≥ esta obra maestra a los dieciocho a√±os, tras leer una selecci√≥n de poemas de Juan Ram√≥n Jim√©nez que despertaron su imaginaci√≥n c√≥smica. La pintura rompe con la perspectiva tradicional para mostrar un mundo c√∫bico donde figuras femeninas tocan instrumentos y encienden estrellas. Su est√©tica mezcla influencias del surrealismo, el expresionismo alem√°n y el arte de vanguardia que llegaba a cuentagotas a provincias espa√±olas. Fue recibida con asombro en el Sal√≥n de Oto√±o de Madrid, donde intelectuales como Garc√≠a Lorca quedaron fascinados por su audacia. Representa el potencial creativo de las mujeres de la Generaci√≥n del 27, muchas veces silenciadas por la historia oficial.",
                zone: "Realismo M√°gico"},

            { id: 7, year: 1929, artist: "Salvador Dal√≠", title: "El Paisaje de la Ansiedad", 
            loc: "Sabatini, P2, Sala 205", clue: "Una cabeza gigante que se derrite en la playa con pelo punky y una estatua de una pilila muy peque√±a.", 
            answer: "Salvador Dal√≠, 'El gran masturbador'", 
            challenge: "¬øQu√© insecto est√° pegado a la cara de la figura principal?", 
                requiredValue: "SALTAMONTES", 
                hint: "Era una de las grandes fobias de Dal√≠.",
            context: "Considerada la culminaci√≥n del surrealismo daliniano, esta obra es un mapa visual de sus obsesiones y temores m√°s profundos. La figura central es un autorretrato basado en una formaci√≥n rocosa del Cabo de Creus, que aparece con los ojos cerrados, entregado al sue√±o o la fantas√≠a. Elementos como el saltamontes (fobia infantil de Dal√≠), las hormigas (s√≠mbolo de putrefacci√≥n) y el lirio blanco representan una lucha interna entre el deseo y el miedo. La aparici√≥n de un busto femenino cerca de la boca de la cabeza alude a la llegada de Gala, quien cataliz√≥ su liberaci√≥n art√≠stica y personal. Es una pieza fundamental para comprender c√≥mo el psicoan√°lisis de Freud fue traducido al lenguaje pict√≥rico.",
                zone: "Surrealismo" },
            
            { id: 8, year: 1937, artist: "Pablo Picasso", title: "El Grito de la Historia", 
            loc: "Sabatini, P2, Sala 205", 
            clue: "Un mural inmenso en blanco y negro.", 
            answer: "Pablo Picasso, 'Guernica'",
            challenge: "¬øQu√© objeto sostiene la mujer que se asoma por la ventana superior derecha?", 
                requiredValue: "QUINQU√â", 
                hint: "Es una l√°mpara de aceite o vela.",
            context: "Encargado por el Gobierno de la Rep√∫blica para el Pabell√≥n Espa√±ol de la Exposici√≥n Universal de Par√≠s de 1937, el 'Guernica' es el mayor icono art√≠stico del siglo XX. Picasso utiliz√≥ la noticia del bombardeo de la villa vasca por la aviaci√≥n nazi para crear una alegor√≠a universal contra la barbarie y el dolor humano. Al eliminar el color, el artista otorg√≥ a la obra un car√°cter fotogr√°fico y documental, similar a los peri√≥dicos de la √©poca. Personajes como la madre con el hijo muerto, el caballo herido y el guerrero ca√≠do representan el sufrimiento de la poblaci√≥n civil. La obra no regres√≥ a Espa√±a hasta 1981, cumpliendo el deseo de Picasso de que solo volviera cuando se restaurara la democracia.",
                zone: "Obra Maestra" },

            { id: 9, year: 1932, artist: "Salvador Dal√≠", title: "El hombre invisible", 
            loc: "Sabatini, P2, Sala 206", 
            clue: "Un demogorgon con dos sirenas mirando desde un paco, un caballo, una columna y todo lo que puedas imaginar.", 
            answer: "Salvador Dal√≠, 'L'HOMME Invisible'", 
            challenge: "¬øCu√°ntas columnas hay visibles en el cuadro?", 
                requiredValue: "14", 
                hint: "Cuenta con cuidado la mano que emerge de la estructura.",
            context: "Es una de sus primeras obras donde materializa su m√©todo paranoico con im√°genes dobles. √âl mismo describ√≠a estas im√°genes como la representaci√≥n de un objeto que, sin modificaci√≥n anat√≥mica es al mismo tiempo la representaci√≥n de otro objeto completamente diferente. Se revela la imagen de un hombre sentado con las manos en las rodillas, como un coloso egipcio. Algunas figuras son im√°genes dobles, como la mujer tumbada - caballo o el jarr√≥n - cara. ",
                zone: "Abstracci√≥n de signos" },

            { id: 10, year: 1933, artist: "Pablo Gargallo", title: "El Profeta en Hierro", 
            loc: "Sabatini, P2, Sala 206", 
            clue: "Escultura met√°lica de un hombre en los huesos, pero con 1 ala y un barrote en la mano", 
            answer: "Pablo Gargallo, 'Grand Prophete'",
            challenge: "¬øQu√© material met√°lico compone esta escultura?", 
                requiredValue: "HIERRO", 
                hint: "Es un metal industrial oscuro.", 
            context: "Pablo Gargallo revolucion√≥ la escultura al introducir el 'vaciado' y el uso del hierro industrial como materiales nobles. En 'El Profeta', el volumen de la figura no se define por la masa, sino por el aire y el espacio vac√≠o que queda entre las l√°minas de metal. La figura representa a un orador con el brazo levantado y la boca abierta en un grito eterno, simbolizando la fuerza de la palabra y la profec√≠a. Esta t√©cnica de desmaterializaci√≥n fue clave para el desarrollo de la escultura moderna, influyendo profundamente en artistas posteriores. La obra combina la robustez del material con una ligereza visual asombrosa, convirti√©ndose en un hito del cubismo escult√≥rico.",
                zone: "Escultura" },

            { id: 11, year: 1922, artist: "Francis Picabia", title: "La M√°quina Dada√≠sta", 
            loc: "Sabatini, P2, Sala 207", 
            clue: "Busca un dibujo mec√°nico que parece un esquema industrial con c√≠rculos, cables y cajones.", 
            answer: "Francis Picabia, 'Totalizador'", 
            challenge: "¬øDe qu√© color es el c√≠rculo m√°s grande de la composici√≥n?", 
                requiredValue: "NEGRO", 
                hint: "Es el color dominante en los engranajes.",
            context: "Picabia fue uno de los motores del movimiento Dad√° y pas√≥ un tiempo crucial en Barcelona y Madrid, donde edit√≥ su revista '391'. En 'Totalizadora', el artista utiliza el lenguaje de los diagramas t√©cnicos para parodiar la fe ciega de la humanidad en el progreso industrial. La obra sugiere que los seres humanos se estaban convirtiendo en engranajes de una maquinaria social absurda y sin prop√≥sito. Al despojar al dibujo t√©cnico de su utilidad, Picabia obliga al espectador a cuestionar la l√≥gica y la est√©tica de su tiempo. Es una pieza clave para entender la ruptura total con la belleza acad√©mica que propugnaban las vanguardias internacionales.",
                zone: "Dada√≠smo" },

            { id: 12, year: 1965, artist: "Antoni T√†pies", title: "La Pared de la Memoria", 
            loc: "Sabatini, P4, Sala 406", 
            clue: "Un lienzo que parece un muro real, con arena.", 
            answer: "Antoni T√†pies, 'Relieve ocre y rosa'", 
            challenge: "¬øQu√© letra del alfabeto est√° rayada en la superficie ocre?", 
                requiredValue: "X", 
                hint: "Es el s√≠mbolo de la inc√≥gnita.",
            context: "Tras la guerra, Antoni T√†pies se convirti√≥ en el m√°ximo exponente del informalismo mat√©rico en Espa√±a. Para T√†pies, el cuadro no es una ventana al mundo, sino un objeto f√≠sico, un muro que acumula el paso del tiempo y las heridas de la historia. El uso de arena, polvo de m√°rmol y pigmentos ocre evoca la tierra de Castilla y la sobriedad del monasterio de El Escorial. La cruz que suele aparecer en sus obras no es solo un s√≠mbolo religioso, sino una marca de identidad y una firma del hombre sobre la materia. Esta obra representa el silencio y la resistencia espiritual durante los a√±os m√°s grises de la dictadura espa√±ola.",
                zone: "Informalismo" },

            { id: 13, year: 1956, artist: "Antonio Saura", title: "El Grito de Lola", 
            loc: "Sabatini, P4, Sala 408", 
            clue: "Retrato femenino distorsionado por brochazos negros.", 
            answer: "Antonio Saura, 'Lola'", 
            challenge: "¬øCu√°ntos ojos (o manchas que simulan ojos) identificas en el rostro?", 
                requiredValue: "2", 
                hint: "Es un retrato humano distorsionado.",
            context: "Antonio Saura, miembro fundador del grupo 'El Paso', utiliz√≥ el gesto violento y la ausencia de color para expresar la angustia existencial. Su serie de retratos 'Lola' toma como base la figura femenina para someterla a una destrucci√≥n pict√≥rica que busca liberar la energ√≠a del artista. Influenciado por las 'Pinturas Negras' de Goya, Saura rechaza la belleza complaciente para mostrar el monstruo que habita en el interior del ser humano. El uso radical del blanco y negro refleja una Espa√±a aislada y tensa, donde la pintura se convierte en un acto de catarsis pol√≠tica y personal. Es una de las cumbres del expresionismo abstracto europeo.",
                zone: "El Paso" },

            { id: 14, year: 1986, artist: "Richard Serra", title: "Esculpir el Acero", 
            loc: "Edificio Nouvel, Patio", 
            clue: "Dos bloques inmensos de acero que parecen flotar.", 
            answer: "Richard Serra, 'Equal-Parallel: Guernica-Bengasi'",
            challenge: "¬øCu√°ntos bloques de acero componen la instalaci√≥n en total?", 
                requiredValue: "4", 
                hint: "Recorre todo el espacio del patio.", 
            context: "Esta instalaci√≥n monumental de Richard Serra es un hito del minimalismo que juega con la percepci√≥n del peso y el espacio del espectador. La obra fue encargada espec√≠ficamente para el museo y establece un di√°logo conceptual con el 'Guernica' de Picasso a trav√©s de su t√≠tulo. Al caminar entre los bloques de acero macizo, el visitante experimenta una sensaci√≥n f√≠sica de opresi√≥n y equilibrio que invita a la reflexi√≥n sobre el poder y la violencia. Serra utiliza materiales industriales para crear una experiencia sensorial pura, despojada de cualquier adorno decorativo. La obra es famosa tambi√©n por su historia: la pieza original desapareci√≥ de los almacenes y tuvo que ser replicada por el artista a√±os despu√©s.",
                zone: "Minimalismo" },

            { id: 15, year: 2005, artist: "Jean Nouvel", title: "La Luz de Nouvel", 
            loc: "Exterior / Terraza Nouvel", 
            clue: "Un techo rojo gigante que vuela sobre los edificios.", 
            answer: "Jean Nouvel, 'Ampliaci√≥n del Museo'", 
            challenge: "¬øDe qu√© color es el techo gigante que cubre la plaza?", 
                requiredValue: "ROJO", 
                hint: "Un color vibrante que contrasta con el cielo.",
            context: "El arquitecto franc√©s Jean Nouvel dise√±√≥ esta ampliaci√≥n para transformar el antiguo hospital en un complejo art√≠stico del siglo XXI. El gran elemento unificador es la techumbre de color rojo brillante realizada en aluminio y fibra de vidrio, que protege el nuevo patio p√∫blico. Sus superficies reflectantes capturan la luz de Madrid y el movimiento de la ciudad, integrando el museo con el barrio de Lavapi√©s. Los tres nuevos edificios (biblioteca, auditorio y salas de exposiciones) rodean una plaza central que funciona como un 'sal√≥n urbano'. Es la parada final de tu misi√≥n: el lugar donde la historia de las salas se encuentra con la vida contempor√°nea de la calle.",
                zone: "Arquitectura" }
        ];

        let completed = [];
        let completedCount = 0;

        function toggleMission(id) {
            const index = missions.findIndex(m => m.id === id);
            if (completed.includes(id)) {
                completed = completed.filter(cId => {
                    const cIndex = missions.findIndex(m => m.id === cId);
                    return cIndex < index;
                });
            } else {
                completed.push(id);
            }
            renderMissions();
            updateProgress();
            renderTimeline();
        }

        function renderMissions() {
            const container = document.getElementById('mission-container');
            container.innerHTML = '';
            missions.forEach((m, idx) => {
                //const isCompleted = completed.includes(m.id);
                const isCompleted = idx < completedCount;
                const isActive = idx === completedCount;
                const isAvailable = idx === 0 || completed.includes(missions[idx-1].id);
                const card = document.createElement('div');
                card.className = `mission-card p-3 rounded-2xl border ${isAvailable ? (isCompleted ? 'completed' : 'active') : 'locked'}`;
                card.innerHTML = `
                    <div class="flex flex-col gap-3">
                        <div class="flex justify-between items-center border-b border-stone-100 pb-4">
                            <div>
                                <div class="text-[10px] font-black text-stone-400 uppercase tracking-widest">Misi√≥n ${idx + 1}</div>
                                <h3 class="text-lg font-black text-stone-800 leading-tight">${m.title}</h3>
                            </div>
                            ${isCompleted ? '<span class="text-green-600 text-2xl">‚úì</span>' : ''}
                        </div>

                        <div class="space-y-3">
                            <div class="flex items-center gap-2">
                                <span class="text-[9px] font-bold bg-red-50 text-red-700 px-2 py-1 rounded-full uppercase">${m.loc}</span>
                            </div>
                            <p class="text-stone-600 italic text-sm leading-snug">"${m.clue}"</p>

                            <div class="${isCompleted ? 'hidden' : 'block'}">
                                <p class="text-stone-700 font-medium mb-4">RETO: ${m.challenge}</p>
                                ${isActive ? `
                                    <div class="flex gap-2">
                                        <input type="text" id="input-${m.id}" placeholder="Introduce tu respuesta..." class="input-code">
                                        <button onclick="checkAnswer(${m.id}, ${idx})" class="bg-stone-900 text-white px-6 py-2 rounded-lg font-bold hover:bg-red-700 transition">VERIFICAR</button>
                                    </div>
                                    <p class="text-[10px] text-stone-400 mt-2">Pista: ${m.hint}</p>
                                ` : '<p class="text-stone-400 italic text-sm">Debes completar la misi√≥n anterior para desbloquear este reto.</p>'}
                            </div>
                            
                            <div class="${isCompleted ? 'block' : 'hidden'} mt-4 bg-stone-50 p-4 rounded-xl border border-stone-100 animate-fade-in">
                                <h4 class="text-[11px] font-black text-red-700 uppercase mb-2">Hallazgo: ${m.answer}</h4>
                                <p class="serif-text text-stone-700 leading-relaxed text-sm">${m.context}</p>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
            updateProgress();
        }

        function checkAnswer(id, index) {
            const input = document.getElementById(`input-${id}`);
            const value = input.value.trim().toUpperCase();
            const mission = missions[index];

            if (value === mission.requiredValue.toUpperCase()) {
                // IMPORTANTE: Sincronizar los dos sistemas
                if (!completed.includes(id)) {
                    completed.push(id); // A√±adimos el ID para que renderTimeline lo vea
                }
                completedCount++;
                
                if (completedCount === missions.length) {
                    document.getElementById('final-screen').classList.remove('hidden');
                }
                
                renderMissions(); // Refresca la lista de misiones
                renderTimeline(); // Refresca la l√≠nea temporal y la bandeja
            } else {
                input.classList.add('error-shake', 'border-red-500');
                setTimeout(() => input.classList.remove('error-shake'), 400);
            }
        }

        function updateProgress() {
            const percent = (completedCount / missions.length) * 100;
            document.getElementById('counter-display').innerText = `${completedCount} / ${missions.length}`;
            document.getElementById('progress-bar').style.width = `${percent}%`;
        }

        function renderTimeline() {
            const tray = document.getElementById('pending-tray');
            const container = document.getElementById('timeline-container');
            
            if (!tray || !container) return;

            tray.innerHTML = '';
            container.innerHTML = '';

            // Filtramos misiones: IDs que est√°n en 'completed' pero NO en 'placedMissions'
            const pending = missions.filter(m => completed.includes(m.id) && !placedMissions.includes(m.id));
            
            if (pending.length === 0) {
                tray.innerHTML = '<p class="text-stone-400 text-sm self-center">Resuelve misiones para obtener piezas...</p>';
            }

            pending.forEach(m => {
                const item = document.createElement('div');
                item.className = `cursor-pointer p-3 bg-white border-2 ${selectedFromTray === m.id ? 'border-red-600 ring-2 ring-red-100' : 'border-stone-200'} rounded-lg shadow-sm text-center w-44 transition-all hover:scale-105`;
                item.onclick = () => { 
                    selectedFromTray = m.id; 
                    renderTimeline(); 
                };
                item.innerHTML = `
                    <div class="text-[10px] font-bold uppercase text-red-700 leading-tight">${m.artist}</div>
                    <div class="text-xs font-black truncate">${m.title}</div>
                    <div class="text-[9px] text-stone-400 mt-1 uppercase font-bold">Seleccionar</div>
                `;
                tray.appendChild(item);
            });

            const allMissionsSorted = [...missions].sort((a, b) => a.year - b.year);

            allMissionsSorted.forEach((m) => {
                const isFoundInGymkana = completed.includes(m.id);
                const isPlacedInTimeline = placedMissions.includes(m.id);
                const element = document.createElement('div');
                
                if (isPlacedInTimeline) {
                    // ESTADO A: Obra correctamente ubicada
                    element.className = "flex flex-col items-center text-center p-4 min-w-[160px] animate-fade-in";
                    element.innerHTML = `
                        <div class="text-2xl font-black text-red-700 mb-1">${m.year}</div>
                        <div class="w-3 h-3 rounded-full bg-red-700 mb-3 ring-4 ring-red-50"></div>
                        <div class="text-[10px] font-bold uppercase tracking-tighter text-stone-800 leading-tight">${m.title}</div>
                        <div class="text-[9px] text-stone-500 italic">${m.artist}</div>
                    `;
                } else if (isFoundInGymkana) {
                    // ESTADO B: Obra desbloqueada en la lista pero esperando ubicaci√≥n
                    element.className = "timeline-slot group active-slot border-red-300 bg-red-50/50";
                    element.onclick = () => attemptPlace(m.id);
                    element.innerHTML = `
                        <span class="slot-year text-stone-600 group-hover:text-red-700">${m.year}</span>
                        <span class="text-[8px] font-bold text-red-400 uppercase mt-1">¬°Ub√≠came aqu√≠!</span>
                    `;
                } else {
                    // ESTADO C: Obra bloqueada
                    element.className = "timeline-slot locked bg-stone-100";
                    element.innerHTML = `
                        <span class="slot-year opacity-30">${m.year}</span>
                        <span class="text-[8px] font-bold text-stone-400 uppercase mt-1">Bloqueado</span>
                    `;
                }
                container.appendChild(element);
            });
        }
        /*
        function renderTimeline() {
            const tray = document.getElementById('pending-tray');
            const container = document.getElementById('timeline-container');
            
            tray.innerHTML = '';
            container.innerHTML = '';
            const pending = missions.filter(m => completed.includes(m.id) && !placedMissions.includes(m.id));
            
            pending.forEach(m => {
                const item = document.createElement('div');
                item.className = `cursor-pointer p-3 bg-white border-2 ${selectedFromTray === m.id ? 'border-red-600 ring-2 ring-red-100' : 'border-stone-200'} rounded-lg shadow-sm text-center w-44 transition-all hover:scale-105`;
                item.onclick = () => { selectedFromTray = m.id; renderTimeline(); };
                item.innerHTML = `
                    <div class="text-[10px] font-bold uppercase text-red-700 leading-tight">${m.artist}</div>
                    <div class="text-xs font-black truncate">${m.title}</div>
                    <div class="text-[9px] text-stone-400 mt-1 uppercase font-bold">Seleccionar</div>
                `;
                tray.appendChild(item);
            });

            const allMissionsSorted = [...missions].sort((a, b) => a.year - b.year);

            allMissionsSorted.forEach((m) => {
                const isFoundInGymkana = completed.includes(m.id);
                const isPlacedInTimeline = placedMissions.includes(m.id);
                const element = document.createElement('div');
                
                if (isPlacedInTimeline) {
                    // ESTADO A: Obra encontrada y correctamente ubicada
                    element.className = "flex flex-col items-center text-center p-4 min-w-[160px] animate-fade-in";
                    element.innerHTML = `
                        <div class="text-2xl font-black text-red-700 mb-1">${m.year}</div>
                        <div class="w-3 h-3 rounded-full bg-red-700 mb-3 ring-4 ring-red-50"></div>
                        <div class="text-[10px] font-bold uppercase tracking-tighter text-stone-800 leading-tight">${m.title}</div>
                        <div class="text-[9px] text-stone-500 italic">${m.artist}</div>
                    `;
                } else if (isFoundInGymkana) {
                    // ESTADO B: Obra encontrada en gymkana pero esperando a ser ubicada
                    element.className = "timeline-slot group active-slot border-red-300";
                    element.onclick = () => attemptPlace(m.id);
                    element.innerHTML = `
                        <span class="slot-year text-stone-600 group-hover:text-red-700">${m.year}</span>
                        <span class="text-[8px] font-bold text-red-400 uppercase mt-1">¬°Ub√≠came aqu√≠!</span>
                    `;
                } else {
                    // ESTADO C: Obra no encontrada a√∫n (Bloqueada)
                    element.className = "timeline-slot locked";
                    element.innerHTML = `
                        <span class="slot-year">${m.year}</span>
                        <span class="text-[8px] font-bold text-stone-400 uppercase mt-1">No descubierta</span>
                    `;
                }
                container.appendChild(element);
            });
        }*/

        function attemptPlace(targetId) {
            if (!selectedFromTray) {
                alert("Primero selecciona una de las obras de la bandeja superior.");
                return;
            }

            if (selectedFromTray === targetId) {
                // √âXITO: La obra seleccionada coincide con el hueco del a√±o
                placedMissions.push(selectedFromTray);
                selectedFromTray = null;
                renderTimeline();
            } else {
                // ERROR: El usuario ha intentado poner la obra en un a√±o que no es el suyo
                const obraEquivocada = missions.find(m => m.id === selectedFromTray);
                alert(`¬°No es correcto! "${obraEquivocada.title}" no se cre√≥ en ese a√±o.`);
            }
        }

        function animateKPIs() {
            animateValue("total-works-display", 0, museumData.totalWorks, 2000);
            animateValue("total-artists-display", 0, museumData.totalArtists, 2000);
        }

        function animateValue(id, start, end, duration) {
            const obj = document.getElementById(id);
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = Math.floor(progress * (end - start) + start).toLocaleString('es-ES');
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        function calculatePercentage(count) {
            return ((count / museumData.totalWorks) * 100).toFixed(3);
        }

        function renderArtistList() {
            const container = document.getElementById('artist-list-container');
            container.innerHTML = ''; // Clear

            museumData.topArtists.forEach((artist, index) => {
                const item = document.createElement('div');
                item.className = `p-4 border-b border-gray-100 cursor-pointer transition-colors duration-200 hover:bg-gray-50 flex justify-between items-center group`;
                item.id = `artist-item-${index}`;
                item.onclick = () => selectArtist(index);

                item.innerHTML = `
                    <div class="flex items-center">
                        <div class="h-8 w-8 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center text-xs font-bold mr-3 group-hover:bg-red-200 group-hover:text-red-900">
                            ${index + 1}
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800">${artist.name}</p>
                            <p class="text-xs text-gray-500">${artist.count} obras</p>
                        </div>
                    </div>
                    <div class="text-gray-300">
                        <span class="text-xl">‚Ä∫</span>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function updateProgress() {
            const current = completed.length;
            const percent = (current / missions.length) * 100;
            document.getElementById('counter-display').innerText = `${current} / ${missions.length}`;
            document.getElementById('progress-bar').style.width = `${percent}%`;
        }

        function selectArtist(index) {
            // Remove active class from all
            for (let i = 0; i < museumData.topArtists.length; i++) {
                const el = document.getElementById(`artist-item-${i}`);
                if (el) el.classList.remove('active-artist');
            }

            // Add active class to selected
            const selectedEl = document.getElementById(`artist-item-${index}`);
            if (selectedEl) selectedEl.classList.add('active-artist');

            selectedArtistIndex = index;
            updateDetailCard(index);
            highlightChartSegment(index);
        }

        function updateDetailCard(index) {
            const artist = museumData.topArtists[index];
            const card = document.getElementById('artist-detail-card');
            
            // Populate data
            document.getElementById('detail-name').innerText = artist.name;
            document.getElementById('detail-count').innerText = artist.count;
            document.getElementById('detail-desc').innerText = artist.desc;
            document.getElementById('detail-percentage').innerText = calculatePercentage(artist.count) + '%';

            // Show card with fade in
            card.classList.remove('hidden');
            card.classList.add('animate-fade-in-up');
        }

        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        function initCharts() {
            // Chart 2: Movement
            const ctxMov = document.getElementById('movementChart').getContext('2d');
            new Chart(ctxMov, {
                type: 'bar',
                data: {
                    labels: ['Sabatini P2', 'Sabatini P4', 'Nouvel'],
                    datasets: [{ label: 'Densidad de Obras Clave', 
                    data: [11, 2, 2], backgroundColor: '#1c1917', borderRadius: 8 }]
                },
                options: { responsive: true, 
                maintainAspectRatio: false, 
                scales: { y: { display: false }, x: { grid: { display: false } } }, 
                plugins: { legend: { display: false } } }
            });

            // Nuevo Chart 3: Distribuci√≥n por Pintor
            const ctx1 = document.getElementById('topArtistsChart').getContext('2d');
            const chartLabels = museumData.topArtists.map(a => a.name);
            const chartData = museumData.topArtists.map(a => a.count);

            mainChartInstance = new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        data: chartData,
                        backgroundColor: [
                            '#C01111', '#F26969', '#fca5a5', '#fee2e2', 
                            '#374151', '#4b5563', '#6b7280', '#9ca3af', '#d1d5db', '#e5e7eb'
                        ],
                        borderWidth: 1,
                        borderColor: '#ffffff',
                        hoverOffset: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '30%',
                    plugins: {
                        legend: {
                            display: false // Hide default legend to use our custom list
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            titleColor: '#111',
                            bodyColor: '#333',
                            borderColor: '#e5e7eb',
                            borderWidth: 1,
                            padding: 18,
                            callbacks: {
                                label: function(context) {
                                    const val = context.raw;
                                    const total = context.chart._metasets[context.datasetIndex].total;
                                    const percentage = ((val / total) * 100).toFixed(1) + '%';
                                    return ` ${val} Obras (${percentage} del Top 10)`;
                                }
                            }
                        }
                    },
                    onClick: (e, elements) => {
                        if (elements.length > 0) {
                            selectArtist(elements[0].index);
                        }
                    }
                }
            });
        }

        function highlightChartSegment(index) {
            if (!mainChartInstance) return;
            
            // Chart.js doesn't have a persistent "highlight" state API easily accessible,
            // but we can simulate it by manipulating dataset colors or triggering tooltip.
            // Here we trigger the tooltip programmatically.
            
            const chart = mainChartInstance;
            chart.setActiveElements([
                { datasetIndex: 0, index: index }
            ]);
            chart.tooltip.setActiveElements([
                { datasetIndex: 0, index: index }
            ]);
            chart.update();
        }

        window.onload = () => {
            animateKPIs();
            renderArtistList();
            renderMissions();
            renderTimeline();
            initCharts();
        };
    </script>
</body>
</html>